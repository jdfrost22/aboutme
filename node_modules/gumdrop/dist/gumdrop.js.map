{"version":3,"file":"gumdrop.js","sources":["../src/local/location.js","../src/utils/resource-path.js","../src/storage/site.js","../src/utils/http-error.js","../src/utils/http-error/not-found.js","../src/utils/http-error/server-error.js","../src/utils/http-error/bad-request.js","../src/remote/resource.js","../src/remote/resource/data.js","../src/dependencies.js","../src/remote/parsers/javascript.js","../src/storage/imports.js","../src/remote/parsers/yaml.js","../src/remote/parsers/json.js","../src/remote/resource/document.js","../src/remote/parsers/markdown.js","../src/remote/parsers.js","../src/remote/fetch.js","../src/storage/resources.js","../src/local/navigation/content.js","../src/local/navigation/highlight.js","../src/local/navigation/links.js","../src/local/navigation/title.js","../src/local/navigation/fragment.js","../src/local/navigation.js","../src/index.js"],"sourcesContent":["const urlRegexp = /^([^#]*)(#!)?\\/?([^#]*)(#)?(.*)$/;\n\nexport class Location {\n  constructor(url = \"\") {\n    this.url = url;\n\n    const splitUrl = url.match(urlRegexp);\n\n    if (splitUrl === null) {\n      throw new Error(\"URL parsing failed\");\n    } else {\n      const [, site, hashBangExists, page, hashSignExists, fragment] = splitUrl;\n\n      this.site = site;\n      this.page = page || \"index\";\n      this.fragment = window.encodeURI(window.decodeURI(fragment));\n      this.isAnchor = !this.isAbsolute && !hashBangExists && hashSignExists;\n    }\n  }\n\n  get isAbsolute() {\n    return this.site !== \"\";\n  }\n\n  getLinkHref(currentPage) {\n    if (!this.isAnchor) {\n      return this.url;\n    }\n\n    return `#!/${currentPage}#${this.fragment}`;\n  }\n}\n","const pathRegexp = /^(\\/)?(.+?)?(?:\\.([^./]+))?$/;\n\nexport class ResourcePath {\n  constructor(path, defaultFolder, defaultType) {\n    const splitPath = pathRegexp.exec(path);\n\n    if (splitPath === null) {\n      this.file = path;\n      this.type = defaultType;\n    } else {\n      const [, isAbsolute, file, type] = splitPath;\n\n      this.file = isAbsolute ? file : `${defaultFolder}/${file}`;\n      this.type = type || defaultType;\n    }\n  }\n\n  get url() {\n    return `${this.file}.${this.type}`;\n  }\n}\n","function getDocumentRoot() {\n  const mainElement = window.document.querySelector(\"main\");\n\n  if (mainElement) {\n    return mainElement;\n  }\n\n  const firstScript = window.document.querySelector(\"script\");\n  const documentRoot = window.document.createElement(\"main\");\n\n  firstScript.parentNode.insertBefore(documentRoot, firstScript);\n\n  return documentRoot;\n}\n\nfunction getDocumentTitle() {\n  return window.document.title;\n}\n\nfunction getDocumentLoader() {\n  return getDocumentRoot().innerHTML;\n}\n\nexport const Site = {\n  root: getDocumentRoot(),\n  title: getDocumentTitle(),\n  loader: getDocumentLoader()\n};\n","export class HttpError extends Error {\n  constructor(httpErrorCode, defaultMessage = \"Unknown error\", message = \"\", details = {}) {\n    super(`<h1>${defaultMessage}</h1><strong>${message}</strong>`);\n\n    this.httpErrorCode = httpErrorCode;\n    this.details = details;\n  }\n}\n","import { HttpError } from \"../http-error\";\n\nexport class NotFound extends HttpError {\n  constructor(message = \"The page you requested does not exist\", details = {}) {\n    super(404, \"404 - Not Found\", message, details);\n  }\n}\n","import { HttpError } from \"../http-error\";\n\nexport class ServerError extends HttpError {\n  constructor(message = \"\", details = {}) {\n    super(500, \"500 - Server Error\", message, details);\n  }\n}\n","import { HttpError } from \"../http-error\";\n\nexport class BadRequest extends HttpError {\n  constructor(message = \"\", details = {}) {\n    super(300, \"300 - Bad Request\", message, details);\n  }\n}\n","export class Resource {\n  constructor(parse) {\n    this.parse = parse;\n  }\n\n  async resolve() {\n    return \"\";\n  }\n}\n","import { Resource } from \"../resource\";\n\nexport class Data extends Resource {\n  constructor(rawData, parse) {\n    super(parse);\n    this.rawData = rawData;\n  }\n\n  async getData() {\n    if (this.parsedData !== undefined) {\n      return this.parsedData;\n    }\n\n    this.parsedData = await this.parse(this.rawData);\n\n    return this.getData();\n  }\n\n  async resolve() {\n    return this.getData();\n  }\n}\n","import { dependencies as dependencyVersions } from \"../package.json\";\n\nexport const dependencies = {\n  extramark: {\n    name: \"extramark\",\n    version: dependencyVersions.extramark,\n    path: \"dist/extramark.min.js\",\n    export: \"ExtraMark\"\n  },\n  mustache: {\n    name: \"mustache\",\n    version: dependencyVersions.mustache,\n    path: \"mustache.min.js\",\n    export: \"Mustache\"\n  },\n  prismjs: {\n    name: \"prismjs\",\n    version: dependencyVersions.prismjs,\n    path: \"prism.min.js\",\n    export: \"Prism\",\n    async callback(dependency, Imports, Prism) {\n      await Imports.get(\"prismjs-autoloader\");\n\n      Prism.plugins.autoloader.languages_path = `${Imports.cdnRoot}/${dependency.name}@${dependency.version}/components/`;\n    }\n  },\n  \"prismjs-autoloader\": {\n    name: \"prismjs\",\n    version: dependencyVersions.prismjs,\n    path: \"plugins/autoloader/prism-autoloader.min.js\",\n    export: \"null\"\n  },\n  \"js-yaml\": {\n    name: \"js-yaml\",\n    version: dependencyVersions[\"js-yaml\"],\n    path: \"dist/js-yaml.min.js\",\n    export: \"jsyaml\"\n  }\n};\n","export async function parseJS(rawData, defaultExportName = undefined) {\n  // eslint-disable-next-line\n  const parse = window.eval.bind(window);\n\n  window.module = {};\n\n  parse(`(function (module) {\n      ${rawData}\n      ${defaultExportName !== undefined ? `module.exports = ${defaultExportName};` : ``}\n    })(window.module)`);\n\n  return window.module.exports;\n}\n","import { NotFound } from \"utils/http-error/not-found\";\nimport { ServerError } from \"utils/http-error/server-error\";\nimport { BadRequest } from \"utils/http-error/bad-request\";\n\nimport { dependencies } from \"dependencies\";\nimport { parseJS } from \"remote/parsers/javascript\";\n\nconst cdnRoot = \"https://cdn.jsdelivr.net/npm/\";\n\nexport const Imports = {\n  _imports: {},\n  cdnRoot,\n  async get(importName) {\n    if (importName in this._imports) {\n      return this._imports[importName];\n    }\n\n    if (!(importName in dependencies)) {\n      throw new Error(`Unknown dependency ${importName}.`);\n    }\n\n    const dependency = dependencies[importName];\n    const url = `${dependency.name}@${dependency.version}/${dependency.path}`;\n\n    const fetchResponse = await window.fetch(cdnRoot + url);\n\n    if (!fetchResponse.ok) {\n      const errorMessage = `Could not load dependency ${importName} from ${cdnRoot}`;\n\n      if (fetchResponse.status === 404) {\n        throw new NotFound(errorMessage);\n      } else if (fetchResponse.status === 400) {\n        throw new BadRequest(errorMessage);\n      } else if (fetchResponse.status >= 500) {\n        throw new ServerError(errorMessage);\n      }\n    }\n\n    const sourceCode = await fetchResponse.text();\n    // eslint-disable-next-line\n    this._imports[importName] = await parseJS(sourceCode, dependency.export || undefined);\n\n    if (dependency.callback) {\n      await dependency.callback(dependency, Imports, this._imports[importName]);\n    }\n\n    return this._imports[importName];\n  }\n};\n","import { ResourcePath } from \"utils/resource-path\";\nimport { Imports } from \"storage/imports\";\n\nexport async function parseYaml(rawData) {\n  const JSYaml = await Imports.get(\"js-yaml\");\n\n  const FileYamlType = new JSYaml.Type(\"!file\", {\n    kind: \"scalar\",\n    resolve(data) {\n      return data !== null;\n    },\n    construct(data) {\n      return new ResourcePath(data, \"data\", \"yaml\");\n    }\n  });\n\n  const YamlWithFilesSchema = JSYaml.Schema.create([FileYamlType]);\n\n  return JSYaml.safeLoad(rawData, { schema: YamlWithFilesSchema }) || {};\n}\n","export async function parseJson(rawData) {\n  return JSON.parse(rawData);\n}\n","import { Imports } from \"storage/imports\";\n\nimport { Data } from \"remote/resource/data\";\nimport { parseYaml } from \"remote/parsers/yaml\";\nimport { parseJson } from \"remote/parsers/json\";\n\nimport { Resource } from \"../resource\";\n\nconst frontMatterRegexp = /^---[ \\t]*(\\r?\\n.*?\\r?\\n|\\r?\\n)---[ \\t]*\\r?\\n(.*)$/s;\n\nexport class Document extends Resource {\n  constructor(rawData, parse) {\n    super(parse);\n\n    const splitDocument = frontMatterRegexp.exec(rawData);\n\n    if (splitDocument === null) {\n      this.context = new Data(\"{}\", parseJson);\n      this.template = rawData;\n    } else {\n      const [, context, template] = splitDocument;\n\n      this.context = new Data(context, parseYaml);\n      this.template = template;\n    }\n  }\n\n  async getData() {\n    return this.context.getData();\n  }\n\n  async resolve() {\n    const Mustache = await Imports.get(\"mustache\");\n\n    const renderedTemplate = Mustache.render(this.template, await this.getData());\n\n    return this.parse(renderedTemplate);\n  }\n}\n","import { Imports } from \"storage/imports\";\n\nexport async function parseMarkdown(rawData) {\n  const ExtraMark = await Imports.get(\"extramark\");\n\n  return ExtraMark.render(rawData);\n}\n","import { parseJson } from \"./parsers/json\";\nimport { parseYaml } from \"./parsers/yaml\";\nimport { parseMarkdown } from \"./parsers/markdown\";\n\nexport const Parsers = {\n  yaml: { type: \"data\", parse: parseYaml },\n  yml: { type: \"data\", parse: parseYaml },\n  json: { type: \"data\", parse: parseJson },\n  md: { type: \"document\", parse: parseMarkdown }\n};\n","import { ResourcePath } from \"utils/resource-path\";\nimport { NotFound } from \"utils/http-error/not-found\";\nimport { ServerError } from \"utils/http-error/server-error\";\nimport { BadRequest } from \"utils/http-error/bad-request\";\nimport { HttpError } from \"utils/http-error\";\n\nimport { Data } from \"remote/resource/data\";\nimport { Document } from \"remote/resource/document\";\nimport { Parsers } from \"remote/parsers\";\n\nasync function resolveResourcePaths(data) {\n  if (typeof data !== \"object\") {\n    return;\n  }\n\n  for (const field in data) {\n    const value = data[field];\n\n    if (value instanceof ResourcePath) {\n      // eslint-disable-next-line\n      data[field] = await fetchResource(value);\n    } else {\n      await resolveResourcePaths(value);\n    }\n  }\n}\n\nexport async function fetchResource(resourcePath) {\n  if (!Object.keys(Parsers).includes(resourcePath.type)) {\n    throw new BadRequest(`Invalid resource type requested`, resourcePath);\n  }\n\n  const fetchResponse = await window.fetch(resourcePath.url, { cache: \"no-cache\" });\n\n  if (!fetchResource.ok) {\n    if (fetchResponse.status === 404) {\n      throw new NotFound();\n    } else if (fetchResponse.status === 400) {\n      throw new BadRequest();\n    } else if (fetchResponse.status >= 500) {\n      throw new ServerError();\n    }\n  }\n\n  try {\n    const rawContent = await fetchResponse.text();\n    const { type, parse } = Parsers[resourcePath.type];\n\n    let resource;\n    if (type === \"data\") {\n      resource = new Data(rawContent, parse);\n    } else if (type === \"document\") {\n      resource = new Document(rawContent, parse);\n    }\n\n    const data = await resource.getData();\n    await resolveResourcePaths(data);\n\n    return resource.resolve();\n  } catch (error) {\n    if (error instanceof HttpError) {\n      throw error;\n    }\n\n    throw new ServerError(\"Invalid content\", error);\n  }\n}\n\nexport async function fetchErrorPage(error) {\n  const errorPath = new ResourcePath(error.httpErrorCode, \"errors\", \"md\");\n\n  try {\n    return await fetchResource(errorPath);\n  } catch (_) {\n    return error.message;\n  }\n}\n","import { fetchResource, fetchErrorPage } from \"remote/fetch\";\n\nexport const Resources = {\n  _resources: {},\n  async get(resourcePath) {\n    const url = resourcePath.url;\n\n    if (url in this._resources) {\n      return this._resources[url];\n    }\n\n    try {\n      // eslint-disable-next-line\n      this._resources[url] = await fetchResource(resourcePath);\n    } catch (error) {\n      // eslint-disable-next-line\n      this._resources[url] = await fetchErrorPage(error);\n    }\n\n    return this._resources[url];\n  }\n};\n","import { ResourcePath } from \"utils/resource-path\";\nimport { Site } from \"storage/site\";\nimport { Resources } from \"storage/resources\";\n\nconst timeoutUntilLoader = 500;\n\nexport async function loadContent(location) {\n  const contentPath = new ResourcePath(location.page, \"pages\", \"md\");\n\n  const loaderTimer = window.setTimeout(function() {\n    Site.root.innerHTML = Site.loader;\n  }, timeoutUntilLoader);\n\n  Site.root.innerHTML = await Resources.get(contentPath);\n\n  window.clearTimeout(loaderTimer);\n}\n","import { Imports } from \"storage/imports\";\n\nexport async function highlightCodeBlocks() {\n  if (!document.querySelector(\"pre > code\")) {\n    return;\n  }\n\n  const Prism = await Imports.get(\"prismjs\");\n\n  Prism.highlightAll();\n}\n","import { Location } from \"local/location\";\n\nexport function updateActiveLinks(location) {\n  const linkElements = document.querySelectorAll(\"a[href]\");\n\n  for (const linkElement of linkElements) {\n    const linkHref = linkElement.getAttribute(\"href\");\n    const linkLocation = new Location(linkHref);\n    const isLinkActive = linkLocation.page === location.page;\n\n    if (linkLocation.isAbsolute) {\n      continue;\n    }\n\n    linkElement.setAttribute(\"href\", linkLocation.getLinkHref(location.page));\n    linkElement.classList.toggle(\"active\", isLinkActive);\n  }\n}\n","import { Site } from \"storage/site\";\n\nexport function updateTitle() {\n  const firstHeading = document.querySelector(\"h1\");\n\n  document.title = firstHeading ? `${firstHeading.textContent} | ${Site.title}` : `${Site.title}`;\n}\n","export function scrollToFragment(location) {\n  const fragmentElement = document.getElementById(location.fragment);\n\n  if (fragmentElement !== null) {\n    fragmentElement.scrollIntoView({ block: \"start\" });\n  } else {\n    window.scrollTo({ top: 0 });\n  }\n}\n","import { Location } from \"local/location\";\n\nimport { loadContent } from \"./navigation/content\";\nimport { highlightCodeBlocks } from \"./navigation/highlight\";\nimport { updateActiveLinks } from \"./navigation/links\";\nimport { updateTitle } from \"./navigation/title\";\nimport { scrollToFragment } from \"./navigation/fragment\";\n\nasync function navigateToPage(location) {\n  await loadContent(location);\n  await highlightCodeBlocks();\n  updateActiveLinks(location);\n  updateTitle();\n}\n\nexport async function handleHashChange(event) {\n  const currentLocation = new Location(event.newURL);\n  const previousLocation = new Location(event.oldURL);\n\n  if (currentLocation.page !== previousLocation.page) {\n    await navigateToPage(currentLocation);\n  }\n\n  scrollToFragment(currentLocation);\n}\n\nexport async function handleLoad() {\n  const currentLocation = new Location(window.location.href);\n\n  await navigateToPage(currentLocation);\n\n  scrollToFragment(currentLocation);\n}\n","import { handleHashChange, handleLoad } from \"local/navigation\";\n\nwindow.addEventListener(\"hashchange\", handleHashChange);\nwindow.addEventListener(\"load\", handleLoad);\n"],"names":["urlRegexp","Location","constructor","url","splitUrl","match","Error","site","hashBangExists","page","hashSignExists","fragment","window","encodeURI","decodeURI","isAnchor","isAbsolute","getLinkHref","currentPage","pathRegexp","ResourcePath","path","defaultFolder","defaultType","splitPath","exec","file","type","getDocumentRoot","mainElement","document","querySelector","firstScript","documentRoot","createElement","parentNode","insertBefore","getDocumentTitle","title","getDocumentLoader","innerHTML","Site","root","loader","HttpError","httpErrorCode","defaultMessage","message","details","NotFound","ServerError","BadRequest","Resource","parse","resolve","Data","rawData","getData","parsedData","undefined","dependencies","extramark","name","version","dependencyVersions","export","mustache","prismjs","callback","dependency","Imports","Prism","get","plugins","autoloader","languages_path","cdnRoot","parseJS","defaultExportName","eval","bind","module","exports","_imports","importName","fetchResponse","fetch","ok","errorMessage","status","sourceCode","text","parseYaml","JSYaml","FileYamlType","Type","kind","data","construct","YamlWithFilesSchema","Schema","create","safeLoad","schema","parseJson","JSON","frontMatterRegexp","Document","splitDocument","context","template","Mustache","renderedTemplate","render","parseMarkdown","ExtraMark","Parsers","yaml","yml","json","md","resolveResourcePaths","field","value","fetchResource","resourcePath","Object","keys","includes","cache","rawContent","resource","error","fetchErrorPage","errorPath","_","Resources","_resources","timeoutUntilLoader","loadContent","location","contentPath","loaderTimer","setTimeout","clearTimeout","highlightCodeBlocks","highlightAll","updateActiveLinks","linkElements","querySelectorAll","linkElement","linkHref","getAttribute","linkLocation","isLinkActive","setAttribute","classList","toggle","updateTitle","firstHeading","textContent","scrollToFragment","fragmentElement","getElementById","scrollIntoView","block","scrollTo","top","navigateToPage","handleHashChange","event","currentLocation","newURL","previousLocation","oldURL","handleLoad","href","addEventListener"],"mappings":"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"}